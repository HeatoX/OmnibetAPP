# OmniBet AI - Phase 2 Premium Expansion

## Overview
Implement the remaining 6 core features to finalize OmniBet AI as a complete commercial product.

---

## Feature 1: Pasarela de Pagos (Stripe / WhatsApp) üí∞

### Purpose
Enable real monetization through subscription upgrades.

### Proposed Changes
#### [NEW] [src/lib/stripe.js](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/stripe.js)
- Initialize Stripe client
- Helper functions for creating checkout sessions

#### [NEW] `src/app/api/checkout/route.js`
- Endpoint to create Stripe Session
- Webhook handler for successful payments (update user tier in DB)

#### [MODIFY] [src/components/UpgradeModal.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/UpgradeModal.jsx)
- Replace dummy buttons with real checkout triggers
- Add "Pay via WhatsApp" button with direct link to sales number

---

## Feature 2: Comparador de Cuotas Real (Odds Comparison) üìà

### Purpose
Show users the best available odds across bookmakers to maximize returns.

### Proposed Changes
#### [MODIFY] [src/lib/real-data-service.js](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/real-data-service.js)
- Update match data structure to include `bookmakers` array (mocked for now based on base odds)
- Generate variations for Bet365, 1xBet, Codere

#### [NEW] [src/components/OddsComparison.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/OddsComparison.jsx)
- Component to display table of bookmakers
- Highlight the "Best Value" cell
- "Apostar" button linking to bookmaker

#### [MODIFY] `src/components/MatchDetailModal.jsx`
- Integrate [OddsComparison](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/OddsComparison.jsx#3-98) inside the prediction view

---

## Feature 3: Calculadora de Stake üíµ

### Purpose
Professional bankroll management tool based on confidence and user balance.

### Proposed Changes
#### [NEW] [src/components/StakeCalculator.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/StakeCalculator.jsx)
- Input: User's total bankroll
- Input: Confidence (auto-filled from match)
- Output: Recommended Stake amount and % (Kelly Criterion simplified)
- Visual "Risk Meter"

#### [MODIFY] `src/components/PredictionCard.jsx`
- Add small "Calc Stake" button or integrate into detailed view

---

## Feature 4: "El Or√°culo AI" (Chatbot) ü§ñ

### Purpose
Interactive AI agent for natural language queries about predictions.

### Proposed Changes
#### [NEW] [src/components/OracleChat.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/OracleChat.jsx)
- Floating chat widget (bottom right bubble)
- Chat interface with history
- "Quick Prompts" (e.g., "Best bet today?", "Safe parlay?")

#### [NEW] `src/app/api/oracle-chat/route.js`
- Simple RAG system: Contextualizes prompt with today's `bankerMatch` and high-confidence predictions
- Returns structured AI response

---

## Feature 5: Gamificaci√≥n / Ranking üèÜ

### Purpose
User engagement through competition.

### Proposed Changes
#### [NEW] `src/components/Leaderboard.jsx`
- Table of top users based on correct votes/predictions
- "My Rank" highlight

#### [MODIFY] [src/lib/history-tracker.js](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/history-tracker.js)
- Function to aggregate user voting accuracy

#### Database (Supabase)
- Use existing `prediction_votes` to calculate accuracy

---

## Feature 6: Buscador Inteligente üîç

### Purpose
Fast navigation to specific teams or leagues.

### Proposed Changes
#### [NEW] [src/components/SmartSearch.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/SmartSearch.jsx)
- Floating search bar (Command+K style)
- Filter matches by Team Name, League, or Sport
- Instant results dropdown

#### [MODIFY] [src/components/Header.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/Header.jsx)
- Add search icon to trigger the component

---

---

## Phase 3: Dashboard Layout Refinement (Centered) üé®

### Purpose
Improve dashboard hierarchy and centered alignment for a cleaner focus.

### Proposed Changes
#### [MODIFY] [src/app/app/page.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/app/app/page.jsx)
- Center the Premium Features zone.
- Reposition Sport Filter below Stats Preview.

#### [MODIFY] [src/components/SportWidgets.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/SportWidgets.jsx)
- Center SportFilter items.
- Redesign LiveSummary as a centered pill button.

---

## Phase 4: Data Reliability & Sport-Specific Fixes üéæ‚öæ

### Purpose
Ensure all sports display data correctly or communicate season status clearly.

### Proposed Changes
#### [MODIFY] [src/lib/real-data-service.js](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/real-data-service.js)
- **Tennis Fix:** Support nested `groupings` in ESPN Scoreboard API.
- **Tennis Fix:** Handle `athlete` objects in competitors (extract name from `athlete.displayName`).
- **Data Bug:** Fix URL malformation when appending query parameters (applied).
- **Baseball Handling:** Detect when a sport has no matches and categorize as "Off-season" if appropriate.

#### [MODIFY] [src/app/app/page.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/app/app/page.jsx)
- Add "Fuera de Temporada" (Off-season) message when a sport is selected but empty.

---

## Execution Order
1. **Layout Refinement** (Done)
2. **Tennis Data Extraction Fix** (Critical)
3. **Off-season Messaging** (UX polish)
