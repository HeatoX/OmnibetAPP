# OmniBet AI - Project Expansion

## Overview
Expand the application to include a comprehensive Admin Dashboard, detailed "Deep Analysis" match views with rich data (H2H, injuries, stats), enhance the landing page with demo interactions, and add 6 premium features for maximum user engagement and conversion.

## Checklist

### [x] Admin Dashboard
- [x] Create `/admin` layout and protection (Admins only)
- [x] User Management Table (View, Block, Delete)
- [x] Sales & Revenue Analytics Chart
- [x] Platform Stats (Active users, predictions generated)
- [x] "God Mode" toggle (Access everything for free)

### [x] Deep Match Analysis (The "Product")
- [x] Create `DetailedMatchView` component
    - [x] Head-to-Head History visualization
    - [x] Team Form Guide (Last 5 matches)
    - [x] Universalize roster fetching (Smart Guess)
    - [x] Implement Form/Standings Fallback for Cup matches
    - [/] Integrate Player Statistics (PPG, etc.)
        [ ] Research statistics endpoints for different sports
        [ ] Update [real-data-service.js](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/real-data-service.js) to fetch athlete stats
        [ ] Map stats in [formatRoster](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/real-data-service.js#582-609) or a new mapping function
        [ ] Update UI (Roster view, Player Modal) to display stats
    - [ ] Final comprehensive testing across sports
    - [x] Player Injuries Report
    - [x] AI "Reasoning" Text Generation
- [x] Implement `MockDeepDataService` to generate realistic stories for demo matches

### [x] Landing Page Enhancements
- [x] Integrate "Deep Analysis" demo into Landing Page (Modal or Inline)
- [x] Ensure "Register" flows correctly to App
- [x] Add "About the App" section explaining the tiers

### [x] Tiered Content Gating
- [x] Restrict predictions visibility (Silver/Gold/Diamond)
- [x] Correct badge labels logic ('diamond', 'gold', 'silver')
- [x] Implement "Unlock" prompt for lower tiers

### [x] Multi-Sport & Data Reliability
- [x] Enable and fix NFL, NBA, Tennis market predictions
- [x] Implement tomorrow's games fetch for daily sports
- [x] Fix "sportMarkets is not iterable" crash
- [x] Remove "Partido muy igualado" fallback labels
- [x] Restore missing Cup endpoints (Copa del Rey, FA Cup, etc.)

---

## Premium Features (NEW)

### [x] Feature 1: Banker of the Day üî•
- [x] Create `BankerCard.jsx` with fire animations
- [x] Select highest confidence match automatically
- [x] Add to main dashboard prominently
- [x] Add CSS fire/glow effects

### [x] Feature 2: Value Bets Monitor üíé
- [x] Create `ValueBetBadge.jsx` component
- [x] Calculate Expected Value (EV) function
- [x] Display when EV > 5% threshold
- [x] Pulse animation for visibility

### [x] Feature 3: Parlay Builder üé∞
- [x] Create [parlay-engine.js](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/parlay-engine.js) with odds calculation
- [x] Create [ParlayBuilder.jsx](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/ParlayBuilder.jsx) UI component
- [x] Risk level selector (Safe/Balanced/Aggressive)
- [x] Copy-to-clipboard for sharing
- [x] Lock for free users

### [x] Feature 4: Community Voting üë•
- [x] Create `CommunityVote.jsx` component
- [x] Create `/api/votes/route.js` API endpoint
- [x] Agree/Disagree with percentage bars
- [x] Social proof indicators

### [x] Feature 5: Telegram Alerts üì±
- [x] Create `telegram-service.js` module
- [x] Create `/api/telegram/route.js` webhook handler
- [x] Bot commands (/start, /subscribe, /status, etc.)
- [x] Diamond alert broadcasting
- [x] Banker of the Day special alerts
- [x] Daily summary messages

### [x] Feature 6: Transparency Dashboard üìä
- [x] Create `history-tracker.js` service
- [x] Create `TransparencyStats.jsx` component
- [x] Record predictions before matches
- [x] Resolve and calculate P&L after
- [x] ROI, win rates, streaks display
- [x] Tier-based performance breakdown

---

## Database & Infrastructure

### [x] Supabase Migrations
- [x] Create `prediction_history` table
- [x] Create `prediction_votes` table
- [x] Create `telegram_subscribers` table
- [x] Create `telegram_link_codes` table
- [x] Set up RLS policies

---

## Verification
- [x] Verify Admin controls works
- [x] Verify Demo User experience
- [x] Verify "Deep Analysis" looks impressive
- [x] Verify upcoming games for all sports appear correctly
- [ ] Test Telegram bot with real account
- [ ] Verify premium features render correctly
- [ ] Test Telegram bot with real account
- [ ] Verify premium features render correctly
- [ ] Test parlay generator with multiple matches

---

## Phase 2: Commercial Expansion (NEW)

### [x] Feature 1: Pasarela de Pagos üí∞
- [x] Create `stripe.js` for checkout logic
- [x] Implement `UpgradeModal` with real payments
- [x] Add WhatsApp Pay direct button

### [x] Feature 2: Comparador de Cuotas üìà
- [x] Create `OddsComparison.jsx` component
- [x] Mock multi-bookmaker data in [real-data-service.js](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/real-data-service.js)
- [x] Integrate into Match Detail view

### [x] Feature 3: Calculadora de Stake üíµ
- [x] Create `StakeCalculator.jsx` component
- [x] Implement Kelly Criterion logic (simplified)
- [x] Add to Prediction Card

### [x] Feature 4: AI Oracle Chatbot ü§ñ
- [x] Create `OracleChat.jsx` floating widget
- [x] Implement RAG endpoint `/api/oracle-chat`
- [x] Contextualize answers with available matches

### [x] Feature 5: Gamificaci√≥n (Leaderboard) üèÜ
- [x] Create `Leaderboard.jsx` component
- [x] Calculate user accuracy from `prediction_votes`
- [x] Display top ranking users

### [x] Feature 6: Buscador Inteligente üîç
- [x] Create `SmartSearch.jsx` overlay
- [x] Implement quick search logic
- [x] Add trigger to Header

### Feature 7: Recent Results (Last 12h) üïí
- [x] Create [getFinishedMatches](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/real-data-service.js#915-979) in [real-data-service.js](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/lib/real-data-service.js) (12h retention)
- [x] Add "Resultados Recientes" section to dashboard
- [x] Style finished cards (dimmed, show score clearly)

## üõ†Ô∏è Bug Fixes & Improvements
- [x] Fix Missing Games: Extended ESPN API fetch window from default to 14 days.
    - Issue: Chelsea games weren't appearing because the API defaults to a short window.
- [x] **Universal Roster Fix:** Implemented "Smart Guess" strategy to find rosters in parent leagues (e.g. Ligue 2 for Cup matches).
    - *Fix:* Added `?dates=YYYYMMDD-YYYYMMDD` parameter to endpoints.
    - *Status:* Verified. Chelsea vs Wolves (Feb 7) is now visible.
- [x] **Add Carabao Cup:** Added `eng.league_cup` endpoint.
    - *Issue:* Chelsea vs Arsenal (Carabao Cup) was missing.
    - *Fix:* Added `ESPN_ENDPOINTS.soccer.carabao` and included in main fetch.
    - *Status:* Verified via debug script.
- [x] **History Page Revamp:**
    - [x] Fix header overlap (Added 160px spacer).
    - [x] Implement `getRealHistory` with backfilled Oracle predictions.
    - [x] Activate real performance stats (Yesterday's results).
    - [x] Centering adjustment: Constrained max-width and centered cards/text.

---

## Phase 3: Dashboard Layout Refinement (NEW)
- [x] Move Sport Filter below "An√°lisis de Hoy" stats card
- [x] Ensure "Tenis" appears next to "NFL" in the filter categories
- [x] Center categories on one line with LiveSummary below
- [x] Style LiveSummary as a centered "button" pill
- [x] Verify alignment and spacing of the new layout

---

## Phase 4: Data Reliability & Sport-Specific Fixes (NEW)
- [x] Fix Tennis match extraction (nested groupings support)
- [x] Update [transformESPNData](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/scripts/verify-tennis.js#15-38) to handle `athlete` objects (Tennis)
- [x] Fix Baseball off-season display/communication
- [x] Verify all sports now show data properly (except off-season)

---

## Phase 5: Oracle v2.0 - The "Neural Swarm" Upgrade (NEW)
- [ ] Create `WeatherService` with OpenMeteo integration
- [ ] Create `RefereeDatabase`, `VenueDatabase`, and `TacticalDatabase`
- [ ] Create `NewsSentinel` (Player Gossip) and `MoraleMonitor` (Locker Room)
- [ ] Create `MarketShark` (Smart Money/Odds Movement Analysis)
- [ ] Upgrade `PredictionOracle` to ingest All 7 Swarm Agents
- [ ] Implement [DetailedMatchAnalysis](file:///C:/Users/PABLO/.gemini/antigravity/scratch/omnibet-ai/src/components/DetailedMatchAnalysis.jsx#8-276) UI updates (Widgets for all factors)
- [ ] Verify "Swarm" logic changes prediction confidence/outputs
